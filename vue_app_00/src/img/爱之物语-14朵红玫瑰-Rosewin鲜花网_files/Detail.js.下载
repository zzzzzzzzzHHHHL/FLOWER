$(function(){
	//大小图片的展示
	var config = {
		showNum : 6
	};
	picShow(config, 'mycarousel1');
	
	//商品大图展示效果
	$(".jqzoom").jqzoom({
		zoomType: 'standard',
		lens:true,
		zoomWidth:388,
		zoomHeight:460,
		xOffset:65,
		preloadImages:false,
		preloadText: '图片加载中',
		yOffset:0
	});
	
	//商品大图点击查看原图
	//$(".jqzoom").click(function(){
	$(document).on("click",".jqzoom",function(e){
		showDetailImg($(".zoomThumbActive").attr("picnum"));
	});
	
	//跨境通提示信息
	$(".pro_taxes_fees").hover(function(){
        $(".pro_hint").show();
	},function(){
        $(".pro_hint").hide();
	});
	
	
	$(".pro_statement .pro_statement_t").click(function(){
		var thisNext = $(this).next(".pro_statement_b");
		if(thisNext.is(":visible")){
			$(this).find(".pst01").removeClass("pst02");
			thisNext.slideUp(200);
		}else{
			$(this).find(".pst01").addClass("pst02");
			$(this).parent("li").siblings().children(".pro_statement_b").slideUp(200);
			$(this).parent("li").siblings().children(".pro_statement_t").find(".pst01").removeClass("pst02");
			thisNext.slideDown(200);
		}
	});
	$(".pro_statement .pro_statement_t:first").click();
	//点击绑定尺码
	$(".pro_size li").hover(function(){
		$(this).children(".size_tip").show();
	},function(){
		$(this).children(".size_tip").hide();
	});
	//分享
	$(".pro_share").hover(function(){
		$(this).children(".pro_share_m").show();
	},function(){
		$(this).children(".pro_share_m").hide();
	});
	
	//商品详情，商品尺码，配送及售后 切换
	var $li = $('#tab li');
    var $ul = $('#product_con .tabCon');
    $li.click(function(){
        var tabsTop = $(".proTab").offset().top;
        var index = $(this).index();
        $li.removeClass();
        $(this).addClass('current');
        $ul.css('display','none');
        $ul.eq(index).css('display','block');
        $("html,body").animate({scrollTop:tabsTop + 1},200);
    });
	$(".proshowsize").click(function(){
		$("#tab").children("li").eq(1).trigger("click");
	});
	
	//商品详情，商品尺码，配送及售后 fixed
	var tabTop = $(".proTab").offset().top;
	$(window).scroll(function(){
		if($(this).scrollTop() > tabTop){
			$(".proTab_m").css({"position":"fixed","top":"0","left":"50%","margin-left":"-600px","z-index":"6"});
			$(".proTab_btn").show();
		}else{
			$(".proTab_m").css({"position":"relative"});
			$(".proTab_btn").hide();
		};
	});
	
	var spic = $("#mycarousel1").children("li").length;
	if(spic > 6){
		$(".goods_scroll").height(420);
	}else{
		$(".goods_scroll").height(spic * 70);
	}
});
//图片点击
function showButton(id, flag) {
	if(flag){
		$("."+id).show();
		$("."+id+"_cur").hide();
	}else {
		$("."+id).hide();
		$("."+id+"_cur").show();
	}
}

//小图片的展示
function picShow(config, id) {
	var scrollUlHeight = $('#'+ id + ' li').outerHeight(true),	//单个 li 的宽度
		scrollUlTop = 0;
	if($('#'+ id + ' li').size()>6) {
		showButton("next", true);
	}

	$('#'+ id + ' .del_btn').bind('click', function() {
		if(id=='mycarousel1') {
			type=1;
		}
		if(deleteFav($(this).parent().parent().attr('id'), type)) {
			$(this).parent().parent().remove();
			if(Math.abs(scrollUlTop) + config.showNum * scrollUlHeight == $('#'+ id + ' li').size()*scrollUlHeight) {
				showButton("next", false);
			}
		}

	})
	//点击上一页
	$('#'+ id).parent().siblings('.prev').click(function() {
		$('#'+ id).animate({
			top : scrollUlTop + scrollUlHeight
		}, 300, function() {
			scrollUlTop = parseInt($('#'+ id).css('top'), 10);
			if(scrollUlTop >= 0) {
				showButton("prev", false);
				if($('#'+ id + ' li').size()>config.showNum){
					showButton("next", true);
				}
			}
			else if($('#'+ id + ' li').size() - Math.abs(scrollUlTop)/scrollUlHeight>config.showNum){
				showButton("next", true);
			}
		})

	});

	//点击下一页
	$('#'+ id).parent().siblings('.next').click(function() {
		$('#'+ id).animate({
			top : scrollUlTop - scrollUlHeight
		}, 300, function() {
			scrollUlTop = parseInt($('#'+ id).css('top'), 10);
			if(Math.abs(scrollUlTop) + config.showNum * scrollUlHeight >= $('#'+ id + ' li').size()*scrollUlHeight) {
				showButton("next", false);
			}
			console.log(1)
			if(scrollUlTop < 0) {
				showButton("prev", true);
			}
		})
	});
}

var picFocusNum = 0;
var pfnum = 0;
//商品大图点击查看原图
function showDetailImg(indexValue){
	var isIE6= /msie 6/i.test(navigator.userAgent);
	if (isIE6){
		$("select").hide();
	}
	var maskHeight = $(document).height();
	var maskWidth = $(window).width();
	$(".mask_img").css({height:maskHeight, width:maskWidth}).show();
	$("#viewImg").fadeIn(200)
	
	if(picFocusNum == 0){
		jQuery(".pf" + pfnum).slide({
			mainCell:".viewImg_slider ul",
			titCell:".viewImg_top li",
			effect:"leftLoop",
			prevCell:".prevBtn"+pfnum,
			nextCell:".nextBtn"+pfnum,
			trigger:"click",
			defaultIndex:0,
			autoPlay:false
		});
		picFocusNum = 1;
	}
	
	$(".viewImg_top li").eq(indexValue - 1).click();
	
	
	
	$(window).scroll(function(){
		var winH = $(window).height();
		var sliderH = $(".viewImg_slider").height() + 115;
		var docTop = $(document).scrollTop();
		if(docTop + 220 > winH){
			$(".viewImg_slider").css({"position":"fixed","top": winH - sliderH + "px"});	
		}else{
			$(".viewImg_slider").css({"position":"static"});
		}
	});
	

}

//关闭商品大图点击查看原图
function closeDetailImg(){
	var isIE6= /msie 6/i.test(navigator.userAgent);
	if (isIE6){
		$("select:hidden").show()
	}
	$("#viewImg, .mask_img").fadeOut(200)
}
